<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>controller</title>
    <!--<script src="/static/jquery.min.js" type="text/javascript"></script>-->
    <script src="/static/jquey.min.1.11.js" type="text/javascript"></script>
    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <style>
        body{
            background-color: #cFcFcF;
        }

        input {
            /*background-color: #A3A3E3!important;*/
        }
        /* Style for the resizable textarea */
        textarea {
            resize: none; /* Prevent manual resizing */
            /*background-color: #A3A3E3!important;*/
            height: auto; /* Auto height to fit content */
            overflow: hidden;
        }

        .nav-link {
            background-color: #b3b3b3!important;
        }

        .nav-link.active {
            background-color: #cFcFcF!important;
            border-color: #cFcFcF !important;
        }

        .modal-body{
            overflow-y: scroll!important; min-height: 100px;
            max-height:50vh!important;
        }

    .dotted-margin{
        border: gray;
        border-width: 1px;
        border-style: dashed
    }

    .row-margin{
        border: #c3c3c3;
        border-width: 1px;
        border-style: solid;
        max-width: 100%;
    }

    
    .custom-button {
            width: 60%;
            overflow: hidden; /* Hide overflow content */
            text-overflow: ellipsis; /* Add ellipsis (...) for overflow text */
            white-space: nowrap; /* Prevent text from wrapping onto a new line */
            word-wrap: break-word; /* Allow words to break onto a new line if necessary */
        }
    </style>
    
  <!--  modalController modalShutdown modalClone exampleModalScript exampleModal
$("#modalController").modal('hide');
$("#modalShutdown").modal('hide');
$("#modalClone").modal('hide');
$("#exampleModalScript").modal('hide');
$("#exampleModal").modal('hide');-->
    <script>
        comands = {};

        const trashIcoonString = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
            <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
            </svg>`;
        var currentSelectedController = "";
        var lastLoadedAmiiboFolder = "{{amiiboFolder}}";
        var amiiboListSrc = [];
        var controllersListSrc = [];
        var scriptsListSrc = [];
        
    function updateTextareas(){
        setTimeout( _=>{
        const textareas2 = document.querySelectorAll('.resizable-textarea');
        textareas2.forEach(function (textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        })},500);
        
        setTimeout( _=>{
        const textareas2 = document.querySelectorAll('.resizable-textarea');
        textareas2.forEach(function (textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        })},1000);
    }

    // Function to show the spinner overlay
    function showSpinner() {
        $("#modalController").modal('hide');
        $("#modalShutdown").modal('hide');
        $("#modalClone").modal('hide');
        $("#exampleModalScript").modal('hide');
        $("#exampleModal").modal('hide');
        $('#spinnerOverlay').modal({ backdrop: 'static', keyboard: false });
    }

    // Function to hide the spinner overlay
    function hideSpinner() {
        $('#spinnerOverlay').modal('hide');
    }

        function displayAmiibos(folderName) {
            folderName = folderName!=null?folderName:lastLoadedAmiiboFolder;
            $("#amiiboList").empty();
            let today = new Date().toLocaleDateString();
            let amiiboContains = $("#amiiboContains").val()!=null?$("#amiiboContains").val():"";
            for (let i = 0; i < amiiboListSrc.length; i++) {
              
                if(amiiboContains === '' || (extractFolderHierarchy(amiiboListSrc[i], folderName)).toLowerCase().includes(amiiboContains.toLowerCase())){
                    const buttonId = "amiibo_btn_"+amiiboListSrc[i];
                    var lastClicked = localStorage.getItem("RJCT_lastClicked_"+buttonId);
                    let divTextForAmiibo = "<div class='row-margin d-flex justify-content-between'>";

                    if (lastClicked!=null && lastClicked.trim().includes(today.trim())) {
                        divTextForAmiibo +="<button id=\""+ buttonId +"\" type=\"button\" class=\"btn btn-warning custom-button\" onclick='sendComandNfc(this,\"" + amiiboListSrc[i] + "\");amiibo_btn(this,\"" + buttonId + "\");'>" + extractFolderHierarchy(amiiboListSrc[i], folderName) + "</button>";
                    }
                    else {
                        divTextForAmiibo +="<button id=\""+ buttonId +"\" type=\"button\" class=\"btn btn-success custom-button\" onclick='sendComandNfc(this,\"" + amiiboListSrc[i] + "\");amiibo_btn(this,\"" + buttonId + "\");'>" + extractFolderHierarchy(amiiboListSrc[i], folderName) + "</button>";
                    }
                    divTextForAmiibo +="<a class=\"btn btn-info d-flex align-items-center\" href='/download?path=" + amiiboListSrc[i] + "'>"+'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">' +
'  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>' +
'  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>' +
'</svg>'+"</a>";
                    
                    divTextForAmiibo +="<button id=\""+ buttonId +"_delete\" type=\"button\" class=\"btn btn-danger\" onclick='delete_amiibo(\"" + amiiboListSrc[i] + "\");'>"+trashIcoonString+"</button>";
                    {% if amiibo_generator_loaded %}
                        divTextForAmiibo +="<button id=\""+ buttonId +"Clone\" type=\"button\" class=\"btn btn-warning\" onclick='cloneModal(this,\"" + amiiboListSrc[i] + "\");'>Clone</button>";
                    {% endif %}
                    divTextForAmiibo += "</div>";
                    $("#amiiboList").append(divTextForAmiibo);
                }
            }
        }

        function sendComandHold(e,cmd) {
            showSpinner();
            if (!comands[cmd]) {
                $.ajax({
                    url: '/comand',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        console.log("Data: " + data + "\nStatus: " + status);
                        comands[cmd] = true;
                        hideSpinner();
                    },
                    error: function(jq, text, errCode){
                        hideSpinner()
                    },
                    data: JSON.stringify({line: 'hold ' + cmd})
                });
            } else {
                $.ajax({
                    url: '/comand',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        console.log("Data: " + data + "\nStatus: " + status);
                        comands[cmd] = false;
                        hideSpinner();
                    },
                    error: function(jq, text, errCode){
                        hideSpinner()
                    },
                    data: JSON.stringify({line: 'release ' + cmd})
                });
            }
        }

        function sendComand(e,cmd) {
            showSpinner();
            $.ajax({
                url: '/comand',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    console.log("Data: " + data + "\nStatus: " + status);
                        hideSpinner();
                    },
                    error: function(jq, text, errCode){
                        hideSpinner()
                    },
                data: JSON.stringify({line: cmd})
            });
        }

        function sendComandNfc(e, nfc){
            showSpinner();
            $.ajax({
                url: '/comand',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    console.log("Data: " + data + "\nStatus: " + status);
                        hideSpinner();
                    },
                    error: function(jq, text, errCode){
                        hideSpinner()
                    },
                data: JSON.stringify({line: 'nfc '+"\""+nfc+"\""})
            });
        }

        function amiibo_btn(e, btn_id){
            let today = new Date().toLocaleDateString();
            e.classList.remove("btn-success");
            e.classList.add("btn-warning");

            // Store the current date as the last clicked date
            localStorage.setItem("RJCT_lastClicked_"+btn_id, today);
        }
        //<!-- checkfilenameAmiiboValid() #filenameAmiibo #filenameAmiiboOrigin #persistAmiiboClone clone() submitAndClone()-->
        function checkfilenameAmiiboValid(){
            let dissabledBut = true;
            $("#persistAmiiboClone").prop("disabled", dissabledBut);
            dissabledBut = !($("#filenameAmiibo").val()).endsWith(".bin");
            $("#persistAmiiboClone").prop("disabled", dissabledBut);
            
        }
        
        function clone(){
         showSpinner();
            $.ajax({
                url: '/amiiboclone',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    requestAmiibosFromFolder(lastLoadedAmiiboFolder);
                    console.log("Data: " + data + "\nStatus: " + status);
                        hideSpinner();
                    },
                    error: function(jq, text, errCode){
                        hideSpinner()
                    },
                data: JSON.stringify({filePath: $("#filenameAmiiboOrigin").val()})
            });
        } 
        function submitAndClone(){
            showSpinner();
            $.ajax({
                url: '/amiiboclone',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    requestAmiibosFromFolder(lastLoadedAmiiboFolder);
                    console.log("Data: " + data + "\nStatus: " + status);
                        hideSpinner();
                    },
                    error: function(jq, text, errCode){
                        hideSpinner()
                    },
                data: JSON.stringify({filePath: $("#filenameAmiiboOrigin").val(), clonePath: $("#filenameAmiibo").val()})
            });
        }

        function cloneReName(originalFileName) {
            // Find the last occurrence of '.' to get the position of the file extension
            const lastDotIndex = originalFileName.lastIndexOf('.');
            let newFileName = originalFileName;

            if (lastDotIndex !== -1) {
            // Extract the filename without the extension and the extension separately
            const fileNameWithoutExtension = originalFileName.substring(0, lastDotIndex);
            const fileExtension = originalFileName.substring(lastDotIndex);

            // Add "_clone" before the extension and combine them
            newFileName = `${fileNameWithoutExtension}_clone${fileExtension}`;

            console.log(newFileName); // This will print "example_clone.bin"
            } else {
            // If there is no file extension, you can choose how to handle it
            console.log("The string does not contain a file extension.");
            }
            return newFileName;
        }


        function cloneModal(e, filePath){
            
            $("#filenameAmiiboOrigin").val(filePath);
            $("#filenameAmiibo").val(cloneReName(filePath));
            checkfilenameAmiiboValid();
            $("#modalClone").modal('show');
        }

        function extractFolderHierarchy(folderUrl, targetFolder) {
            const index = folderUrl.indexOf(targetFolder);
            if (index !== -1) {
                return folderUrl.substring(index + targetFolder.length + 1);
            } else {
                return "Target folder not found in the URL";
            }
        }

function getFileNameFromPath(filePath) {
    var parts = filePath.split('/');
    var fileNameWithExtension = parts[parts.length - 1];
    return fileNameWithExtension;
}

function delete_amiibo(amiiboPath){
    showSpinner();
            $.ajax({
            type: 'POST',
            url: '/delete_amiibo',
            success: function(data, status, xhr) {
                    // Maneja la respuesta del servidor
                    console.log(data); // Aquí puedes imprimir la respuesta en la consola del navegador
                    let folderName = $("#amiibo").val();
                    //amiiboList
                    requestAmiibosFromFolder(folderName);
                    hideSpinner();

            },
            error: function(xhr, status, error) {
                console.error('Error downloading item:', error);
                hideSpinner();
            },
        contentType: 'application/json',
        data: JSON.stringify({path: amiiboPath})
        });
}

        function exportAmiiboList(){

                    // Create a temporary link element to trigger the download
                    var a = document.createElement('a');
                    a.href = "/zip_folder?folder_path=" + $("#amiibo").val();;
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();

                    document.body.removeChild(a)

        }

        

        function requestAmiibosFromFolder(folderName) {
            showSpinner();
            $.ajax({
                url: '/files',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    lastLoadedAmiiboFolder = folderName;
                    console.log("Data: " + data + "\nStatus: " + status);
                    amiiboListSrc = data;
                    hideSpinner
                    displayAmiibos(folderName);
                    hideSpinner();
                },
                error: function(jq, text, errCode){
                    hideSpinner()
                },
                data: JSON.stringify({path: folderName})
            });
        }

        function displayControllers(){
            $("#controllerList").empty();
            
            let contains = $("#controllerContains").val()!=null?$("#controllerContains").val():"";
              
            for (let i = 0; i < controllersListSrc.length; i++) {
                if(contains === '' || (controllersListSrc[i]).toLowerCase().includes(contains.toLowerCase())){
                    let stringControllerDiv = "<div class='row-margin d-flex justify-content-between'>";
                    stringControllerDiv +="<a href='/controller/" + controllersListSrc[i].replace('.json','') + "'>" + controllersListSrc[i] + "</a>";
                    stringControllerDiv +="<div>"
                    stringControllerDiv +="<button type=\"button\" class=\"btn btn-danger\" onclick='deleteController(\"" + controllersListSrc[i].replace('.json','') + "\")'>"+trashIcoonString+"</button>";
                    stringControllerDiv +="<button type=\"button\" class=\"btn btn-primary\" onclick='editController(\"" + controllersListSrc[i].replace('.json','') + "\")'>edit</button>";
                    stringControllerDiv +="</div></div>"
                    $("#controllerList").append(stringControllerDiv);
                }
            }
        }

        function requestControllers(){
            showSpinner();
            $.ajax({
                url: '/controllers',
                type: 'get',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    console.log("Data: " + data + "\nStatus: " + status);
                    controllersListSrc = data;
                    displayControllers();
                    hideSpinner();
                },
                error: function(jq, text, errCode){
                    hideSpinner()
                }
            });
        }

        
        function displayScripts(){
            $("#scripList").empty();
            //scriptContains
            let contains = $("#scriptContains").val()!=null?$("#scriptContains").val():"";
            for (let i = 0; i < scriptsListSrc.length; i++) {
                if(contains === '' || (scriptsListSrc[i]).toLowerCase().includes(contains.toLowerCase())){
                    let stringControllerDiv = "<div class='row-margin d-flex justify-content-between'>";
                    stringControllerDiv +="<button type=\"button\" style=\"width:100%;\" class=\"btn btn-primary\" onclick='editScript(\"" + scriptsListSrc[i].replace('.txt','') + "\")'>"+scriptsListSrc[i]+"</button>";
                    stringControllerDiv +="<button type=\"button\" style=\"width:100%;\" class=\"btn btn-danger\" onclick='deleteScript(\"" + scriptsListSrc[i].replace('.txt','') + "\")'>"+trashIcoonString+"</button>";
                    stringControllerDiv +="</div>"
                    $("#scripList").append(stringControllerDiv);
                }
            }
        }

        function requestScripts(){
            showSpinner();
            $.ajax({
                url: '/scripts',
                type: 'get',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    console.log("Data: " + data + "\nStatus: " + status);
                    scriptsListSrc = data;
                    displayScripts();
                    hideSpinner();
                },
                error: function(jq, text, errCode){
                    hideSpinner()
                }
            });
        }

        // Function to populate the controller select element
        function populateControllerSelect() {
            showSpinner();
            $.ajax({
                url: "/controller_maps",
                type: "GET",
                success: function(response) {
                // Clear the select options
                $("#selectedController").empty();

                // Add an empty option
                var emptyOption = $("<option></option>").attr("value", "").text("Select controller");
                $("#selectedController").append(emptyOption);

                // Add options to the select element
                response.forEach(function(controller) {
                    var option = $("<option></option>").attr("value", controller).text(controller);
                    $("#selectedController").append(option);
                });
                hideSpinner();

                },
                error: function(error) {
                // Handle the error here
                console.log(error);
                hideSpinner();
                }
            });
        }

        // Function to handle the change event on the select element
        function selectController() {
            var selectedController = $("#selectedController").val();
            if (selectController==null || selectedController === "") {
                // Handle the empty selection
                $("#deleteMapButton").prop("disabled", true);

                $.ajax({
                url: "/controller_maps/get",
                type: "GET",
                success: function(response) {
                    // Populate the filename and JSON config
                    $("#filenameControllerCtrMap").val(response.controllerName);
                    currentSelectedController = response.controllerName!=null?response.controllerName:'';
                    $("#selectedCurrentController").text(currentSelectedController);
                    $("#txtBodyControllerCtr").val(JSON.stringify(response.jsonFile, null, 2));
                    updateTextareas();
                    hideSpinner();
                },
                error: function(error) {
                    // Handle the error here
                    console.log(error);
                    hideSpinner();
                }
                });
            } else {
                // Handle the non-empty selection
                $("#deleteMapButton").prop("disabled", false);

                $.ajax({
                url: "/controller_maps/get/" + selectedController,
                type: "GET",
                success: function(response) {
                    // Populate the filename and JSON config
                    currentSelectedController = response.controllerName!=null?response.controllerName:'';
                    $("#selectedCurrentController").text(currentSelectedController);
                    $("#filenameControllerCtrMap").val(response.controllerName);
                    $("#txtBodyControllerCtr").val(JSON.stringify(response.jsonFile, null, 2));
                    updateTextareas();
                    hideSpinner();
                },
                error: function(error) {
                    // Handle the error here
                    console.log(error);
                    hideSpinner();
                }
                });
            }
        }

        // Function to handle the click event on the deleteMapButton
        function deleteControllerMap() {
            showSpinner();
            var selectedController = $("#selectedController").val();

            if (selectedController !== "") {
                $.ajax({
                url: "/delete_controller_map/" + selectedController,
                type: "GET",
                success: function(response) {
                    // Handle the success response here
                    console.log("Controller map deleted:", response.controllerName);

                    // Optionally, perform any additional actions after deleting the map
                    // For example, you can clear the input fields or refresh the list of maps

                    // Disable the deleteMapButton
                    $("#deleteMapButton").prop("disabled", true);
                    populateControllerSelect();
                    updateControllerMapFile();
                    $("#selectedController").val(null);
                    selectController();
                    hideSpinner();
                },
                error: function(error) {
                    // Handle the error here
                    console.log(error);
                    hideSpinner();
                }
                });
            }
        }

        // Function to check the validity of controller map inputs
        function checkControllerMapValid() {
            $("#setMapButton").prop("disabled", true);
            var jsonTextarea = $("#txtBodyControllerCtr");
            var filenameInput = $("#filenameControllerCtrMap");
            var jsonConfig = jsonTextarea.val();
            var filename = filenameInput.val();

            // Validate JSON input
            try {
                JSON.parse(jsonConfig);
                jsonTextarea.removeClass("is-invalid");
                jsonTextarea.next(".invalid-feedback").hide();
            } catch (error) {
                jsonTextarea.addClass("is-invalid");
                jsonTextarea.next(".invalid-feedback").text("Invalid JSON format").show();
                return; // Stop validation if JSON is invalid
            }

            // Validate filename input
            var filenameExtension = filename.split(".").pop().toLowerCase();
            var validExtensions = ["json"];

            if (filename.trim() === "") {
                filenameInput.addClass("is-invalid");
                filenameInput.next(".invalid-feedback").text("Filename is required").show();
            } else if (!validExtensions.includes(filenameExtension)) {
                filenameInput.addClass("is-invalid");
                filenameInput.next(".invalid-feedback").text("Invalid file extension").show();
            } else {
                $("#setMapButton").prop("disabled", false);
                filenameInput.removeClass("is-invalid");
                filenameInput.next(".invalid-feedback").hide();
            }
        }

        // Function to update the controller map
        function updateControllerMap() {
            var jsonTextarea = $("#txtBodyControllerCtr");
            var filenameInput = $("#filenameControllerCtrMap");
            var jsonConfig = jsonTextarea.val();
            var filename = filenameInput.val();

            // Validate JSON input
            try {
                JSON.parse(jsonConfig);
                jsonTextarea.removeClass("is-invalid");
                jsonTextarea.next(".invalid-feedback").hide();
            } catch (error) {
                jsonTextarea.addClass("is-invalid");
                jsonTextarea.next(".invalid-feedback").text("Invalid JSON format").show();
                return; // Stop updating if JSON is invalid
            }

            // Validate filename input
            var filenameExtension = filename.split(".").pop().toLowerCase();
            var validExtensions = ["json"];

            if (filename.trim() === "") {
                filenameInput.addClass("is-invalid");
                filenameInput.next(".invalid-feedback").text("Filename is required").show();
                return; // Stop updating if filename is invalid
            } else if (!validExtensions.includes(filenameExtension)) {
                filenameInput.addClass("is-invalid");
                filenameInput.next(".invalid-feedback").text("Invalid file extension").show();
                return; // Stop updating if filename extension is invalid
            } else {
                filenameInput.removeClass("is-invalid");
                filenameInput.next(".invalid-feedback").hide();
            }

            // Prepare the data for the AJAX request
            var requestData = {
                filename: filename,
                json: JSON.parse(jsonConfig)
            };
            showSpinner();
            // Send the AJAX request
            $.ajax({
                url: "/controllers_maps_post",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(requestData),
                success: function(response) {
                    currentSelectedController = response.controllerName!=null?response.controllerName:'';
                    $("#selectedCurrentController").text(currentSelectedController);
                    $("#selectedController").val(currentSelectedController);
                    $("#txtBodyControllerCtr").val(JSON.stringify(response.jsonFile, null, 2));
                    updateTextareas();
                    populateControllerSelect();
                    // Handle the success response here
                    console.log("Controller map created:", response);
                    $('#modalController').modal('toggle');
                    hideSpinner();
                    // Optionally, perform any additional actions after updating the map
                    // For example, you can clear the input fields or refresh the list of maps
                },
                error: function(error) {
                // Handle the error here
                hideSpinner();
                console.log(error);
                }
            });
        }


        function fillAmiiboList() {
            let folderName = $("#amiibo").val();
            //amiiboList
            requestAmiibosFromFolder(folderName);
        }

        function uploadAmiibo(){

            var formData = new FormData();
            formData.append('file', $('#amiibofile')[0].files[0]); // Obtén el archivo seleccionado
            showSpinner();
            // Realiza la solicitud AJAX
            $.ajax({
                url: '/upload', // Ruta del servidor donde procesarás la carga del archivo
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    // Maneja la respuesta del servidor
                    console.log(response); // Aquí puedes imprimir la respuesta en la consola del navegador
                    
                    requestAmiibosFromFolder(lastLoadedAmiiboFolder);
                    hideSpinner();
                    // Dependiendo de la respuesta, puedes realizar acciones específicas en el cliente
                    // Por ejemplo, mostrar un mensaje de éxito o error al usuario, redirigirlo a otra página, etc.
                },
                error: function(xhr, status, error) {
                    // Maneja los errores de la solicitud AJAX
                    console.error(error);
                    hideSpinner();
                }
            });
        }

        

        function uploadConfFile(filetype){

            var formData = new FormData();
            formData.append('file', $('#'+filetype)[0].files[0]); // Obtén el archivo seleccionado
            showSpinner();
            // Realiza la solicitud AJAX
            $.ajax({
                url: '/uploadcnf/'+filetype, // Ruta del servidor donde procesarás la carga del archivo
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    hideSpinner();
                    location.reload();
                },
                error: function(xhr, status, error) {
                    hideSpinner();
                    location.reload();
                }
            });
            }

        function Connection(e) {
            showSpinner();
            $.get("/connected", function (data, status) {
                console.log("Data: " + data + "\nStatus: " + status);
                if (data.connected) {
                    $.get("/disconnect", function (data, status) {
                        hideSpinner();
                        console.log("Data: " + data + "\nStatus: " + status);
                    });
                } else {
                    $.get("/connect", function (data, status) {
                        hideSpinner();
                        console.log("Data: " + data + "\nStatus: " + status);
                    });
                }
            });
        }

        function ShutDown(e){
            showSpinner();
            $.ajax({
                url: '/system',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    hideSpinner();
                    console.log("Data: " + data + "\nStatus: " + status);
                },
                error: function(xhr, status, error) {
                    hideSpinner();
                },
                data: JSON.stringify({action: 'shutdown'})
            });
        }

        function Reboot(e){
            showSpinner();
            $.ajax({
                url: '/system',
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                success: function (data, status) {
                    console.log("Data: " + data + "\nStatus: " + status);
                    hideSpinner();
                },
                error: function(xhr, status, error) {
                    hideSpinner();
                },
                data: JSON.stringify({action: 'reboot'})
            });
        }
//<!-- conTab ambTab scrTab -->
        function showAmiiboMenu() {
            // Add multiple classes to the element
            $("#conTab").removeClass("active");
            $("#ambTab").removeClass("active").addClass("active");
            $("#scrTab").removeClass("active");

            $("#controller").hide();
            $("#scriptlister").hide();
            $("#amiboolister").show();
        }

        function showController() {
            $("#conTab").removeClass("active").addClass("active");
            $("#ambTab").removeClass("active");
            $("#scrTab").removeClass("active");
            $("#amiboolister").hide();
            $("#scriptlister").hide();
            $("#controller").show();
        }

        function showScripts(){
            $("#conTab").removeClass("active");
            $("#ambTab").removeClass("active");
            $("#scrTab").removeClass("active").addClass("active");
            $("#amiboolister").hide();
            $("#controller").hide();
            $("#scriptlister").show();
        }

        // Add an event listener to the modal
        function updateControllerMapFile() {
            fetch('/controller_map_file')
                .then(response => response.json())
                .then(data => {
                // Update the variable with the filename
                    currentSelectedController = data.fileName!=null?data.fileName:'';
                    $("#selectedCurrentController").text(currentSelectedController);
                })
                .catch(error => {
                console.error('Error:', error);
                });
        }

        $(document).ready(function () {
            showController();
            if("{{amiiboFolder}}"!=""){
                requestAmiibosFromFolder("{{amiiboFolder}}");
            }
            requestControllers();
            requestScripts();
            populateControllerSelect();
            selectController();
            {% if mapControllerFile %}
                currentSelectedController = "{{ mapControllerFile }}";
                $("#selectedCurrentController").text(currentSelectedController);
            {% endif %}

            // Call the function immediately
            updateControllerMapFile();

            // Call the function every minute (60,000 milliseconds)
            setInterval(updateControllerMapFile, 60000);
            $("#modalController").on("shown.bs.modal", function() {
                $("#selectedController").val(currentSelectedController);
                selectController();
            });
        });


        function isJsonString(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }

        function isEmptyOrSpaces(str){
            return str === null || str.match(/^ *$/) !== null;
        }

        function checkControllerJsonValid() {
            const val = $("#jsonBodyController").val();
            //submitController
            if(isJsonString(val)){
                const val2 = $("#filenameController").val();
                if(isEmptyOrSpaces(val2)){
                     $('#submitController').prop('disabled', true);
                     $('#positionController').prop('disabled', true);
                }
                else {
                    $('#submitController').prop('disabled', false);
                     $('#positionController').prop('disabled', false);
                }
            }else {
                $('#submitController').prop('disabled', true);
                $('#positionController').prop('disabled', true);
            }
        }

        function checkControllerScriptValid(){
            const val = $("#filenameControllerScript").val();
            //submitController
            if(!isEmptyOrSpaces(val)){
                const val2 = $("#txtBodyControllerScript").val();
                if(isEmptyOrSpaces(val2)){
                     $('#submitScript').prop('disabled', true);
                     $('#submitAndRun').prop('disabled', true);
                }
                else {
                    $('#submitScript').prop('disabled', false);
                    $('#submitAndRun').prop('disabled', false);
                }
            }else {
                $('#submitScript').prop('disabled', true);
                $('#submitAndRun').prop('disabled', true);
            }
        }

        function editController(controllerName){
            showSpinner();
            $.ajax({
                    url: '/controllers/'+controllerName,
                    type: 'get',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        $("#jsonBodyController").val(JSON.stringify(data.jsonFile,null, 3));
                    updateTextareas();
                        $("#filenameController").val(data.controllerName);
                        $('#exampleModal').modal('toggle');
                        checkControllerJsonValid();
                        hideSpinner();
                    },
                    error: function(xhr, status, error) {
                        hideSpinner();
                    }
                });
        }

        function deleteController(controllerName){
            showSpinner();
            $.ajax({
                    url: '/delete_controller/'+controllerName,
                    type: 'get',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        requestControllers();
                        hideSpinner();
                    },
                    error: function(xhr, status, error) {
                        hideSpinner();
                    }
                });
        }

        function editScript(controllerName){
            showSpinner();
            $.ajax({
                    url: '/scripts/'+controllerName,
                    type: 'get',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        $("#txtBodyControllerScript").val(data.jsonFile);
                        $("#filenameControllerScript").val(data.controllerName);
                        $('#exampleModalScript').modal('toggle');
                        updateTextareas();
                        console.log('data script', data);
                        checkControllerScriptValid();
                        hideSpinner();
                    },
                    error: function(xhr, status, error) {
                        hideSpinner();
                    }
                });
        }

        function deleteScript(controllerName){
            showSpinner();
            $.ajax({
                    url: '/delete_script/'+controllerName,
                    type: 'get',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        requestScripts();
                    hideSpinner();
                },
                error: function(xhr, status, error) {
                    hideSpinner();
                }
                });
        }

        function cleanControllerForm(){
            $("#jsonBodyController").val("");
                    updateTextareas();
            $("#filenameController").val("");
        }

        function cleanScriptsForm(){
            $("#txtBodyControllerScript").val("");
                    updateTextareas();
            $("#filenameControllerScript").val("");
        }

        function showCurrentScriptForm(){
            $("#txtBodyControllerScript").val("");
                    updateTextareas();
            $("#filenameControllerScript").val("");
            showSpinner();
            $.ajax({
                    url: '/last-actions',
                    type: 'get',
                    contentType: 'application/json',
                    success: function (data, status) {
                        $("#txtBodyControllerScript").val(data.message);
                    updateTextareas();
                        $("#filenameControllerScript").val("");
                        hideSpinner();
                    },
                    error: function(xhr, status, error) {
                        hideSpinner();
                    }
                });

        }
        
        function cleanCurrentScriptForm(){
            const comandDelay = $("#comandDelay").val();
            const maxComandLines = $("#maxComandLines").val();
            showSpinner();
            $.ajax({
                    url: '/reset-actions',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        hideSpinner();
                    },
                    error: function(xhr, status, error) {
                        hideSpinner();
                    },
                    data: JSON.stringify({maxComandLines: maxComandLines, comandDelay: comandDelay})
                });
        }

        function positionObjects(){
            const bodyVal = $("#jsonBodyController").val();
                    updateTextareas();
            const filenameVal = $("#filenameController").val();
            $.ajax({
                    url: '/controllers',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
	                    window.location.href = '/position_objects/'+filenameVal;
                    },
                    data: JSON.stringify({json: JSON.parse(bodyVal), filename: filenameVal+".json"})
                });
        }

        function updateJsonController(){
            showSpinner();
            const bodyVal = $("#jsonBodyController").val();
            const filenameVal = $("#filenameController").val();
            $.ajax({
                    url: '/controllers',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        requestControllers();
                        $('#exampleModal').modal('toggle');
                        hideSpinner();
                    },
                    error: function(xhr, status, error) {
                        hideSpinner();
                    },
                    data: JSON.stringify({json: JSON.parse(bodyVal), filename: filenameVal+".json"})
                });
        }

        function updateScript(){
            const bodyVal = $("#txtBodyControllerScript").val();
            const filenameVal = $("#filenameControllerScript").val();
            showSpinner();
            $.ajax({
                    url: '/scripts',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        requestScripts();
                        $('#exampleModalScript').modal('toggle');
                        hideSpinner();
                    },
                    error: function(xhr, status, error) {
                        hideSpinner();
                    },
                    data: JSON.stringify({data: bodyVal, filename: filenameVal+".txt"})
                });
        }

        function submitAndRun(){

            const bodyVal = $("#txtBodyControllerScript").val();
            const filenameVal = $("#filenameControllerScript").val();
            const repetitions = $("#repetitions").val();
            
            $.ajax({
                    url: '/scripts',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data, status) {
                        $.ajax({
                            url: '/execute_script',
                            type: 'post',
                            dataType: 'json',
                            contentType: 'application/json',
                            complete: function (data, status) {
                                console.log("Data: " + data + "\nStatus: " + status);
                            },
                            data: JSON.stringify({script: "rjctScripts/"+filenameVal+".txt", nfc:"", repeats: repetitions})
                        });
                    },
                    data: JSON.stringify({data: bodyVal, filename: filenameVal+".txt"})
                });
        }

        function killScript(){
            $.get("/kill_script", function (data, status) {
                console.log("Data: " + data + "\nStatus: " + status);
            });
        }
    </script>

</head>
<body>
<div class="modal" id="spinnerOverlay" style="display: none;">
    <div class="modal-dialog" role="document">
        <div class="d-flex justify-content-center align-items-center" style="height: 100vh;">
            <div class="spinner-border text-success" role="status">
                <span class="sr-only"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                    <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
                    <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
                  </svg></span>
            </div>
        </div>
    </div>
</div>
<div style="width: 100%">
    <div class="d-flex justify-content-around bg-info" style="padding: 2px;">
        <ul class="nav">
            <li class="nav-item">
                <button type="button" class="btn btn-success" data-toggle="modal" data-target="#modalController">
                    Controller map: 
                    <span id="selectedCurrentController"></span>
                </button>
            </li>
        </ul>
        <ul class="nav">
            <div></div>
        </ul>
        <ul class="nav">
            <li>
                <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#modalShutdown">
                    Connection
                </button>
            </li>
        </ul>
    </div>
    <div class="bg-info">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" id="conTab" aria-current="page" href="#" onclick="showController()">Controllers</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="ambTab"  href="#" onclick="showAmiiboMenu()">Amiibos</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="scrTab"  href="#" onclick="showScripts()">Scripts</a>
            </li>
        </ul>
    </div>
    <div id="controller">
        <div class="d-flex justify-content-between">
            <div></div>
            <button type="button" class="btn btn-success" onclick="requestControllers()">reload</button>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" onClick="cleanControllerForm()">
                Create controller
            </button>
        </div>
        <div class="form-group dotted-margin">
            <div class="form-outline">
            <input type="search" placeholder="Search" id="controllerContains" class="form-control" onchange="displayControllers()" />
            </div>
        </div>
        <div id="controllerList" class="d-flex flex-column justify-content-around">
        </div>
    </div>
    <div id="amiboolister">
        <div class="d-flex justify-content-between">
            <div></div>
            <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#colapseFileControl" aria-expanded="false">
                show/hide
            </button>
        </div>
        <div id="colapseFileControl" class="panel-collapse collapse in">
            <div class="panel-body">
                <div class="dotted-margin">
                    <div class="form-group">
                        <label for="amiibo">AmiiboFolder</label>
                        <input type="text" class="amiibo" id="amiibo" aria-describedby="amiibot"
                            placeholder="Enter amiibo folder" value="{{amiiboFolder}}">
                        <small id="amiibot" class="form-text text-muted">Folder where amiibos are found</small>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="fillAmiiboList()">Folder content</button>
                        <button class="btn btn-success" onclick="exportAmiiboList()">Export Folder content</button>
                    </div>
                </div>
                <div class="dotted-margin">
                    <div class="form-group">
                        <label for="amiibofile">Amiibo File</label>
                        <input type="file" name="amiibofile" id="amiibofile" placeholder=".bin/.zip">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="uploadAmiibo()">Upload amiibo</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group dotted-margin">
            <div class="form-outline">
            <input type="search" placeholder="Search" id="amiiboContains" class="form-control" onchange="displayAmiibos(null)" />
            </div>
        </div>
        <div id="amiiboList" class="d-flex flex-column justify-content-around"></div>
    </div>
    <div id="scriptlister">
        <div class="d-flex justify-content-between">
            <div></div>
            <button type="button" class="btn btn-success" onclick="requestScripts()">reload</button>
            <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#colapseScriptControl" aria-expanded="false">
                show/hide
            </button>
        </div>
        <div id="colapseScriptControl" class="panel-collapse collapse in">
            <div class="panel-body">
                <div class="d-flex justify-content-between">
                    <div class="d-flex flex-column justify-content-around">
                        <div class="form-outline">
                            <input type="number" id="maxComandLines" class="form-control" value="{{maxComandLines}}" />
                            <label class="form-label" for="maxComandLines">max stored comands</label>
                        </div>
                        <div class="form-outline">
                            <input type="number" id="comandDelay" class="form-control" value="{{comandDelay}}" />
                            <label class="form-label" for="comandDelay">comand delay</label>
                        </div>
                        <button type="button" class="btn btn-warning" onclick="cleanCurrentScriptForm()">
                            clean current
                        </button>
                    </div>
                    <div class="d-flex flex-column justify-content-around">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalScript" onclick="showCurrentScriptForm()">
                            Current script
                        </button>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#exampleModalScript" onclick="cleanScriptsForm()">
                            Create script
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group dotted-margin">
            <div class="form-outline">
            <input type="search" placeholder="Search" id="scriptContains" class="form-control" onchange="displayScripts()" />
            </div>
        </div>
        <div id="scripList" class="d-flex flex-column justify-content-around">
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Controller config</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="filenameController">File name</label>
                <input type="text" class="form-control" id="filenameController" onchange="checkControllerJsonValid()" placeholder="Enter filename">
            </div>
            <div class="form-group">
                <label for="jsonBodyController">Json config</label>
                <textarea class="form-control resizable-textarea" id="jsonBodyController" min-rows="3" onchange="checkControllerJsonValid()"></textarea>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="positionController"  data-dismiss="modal" disabled onclick="positionObjects()">positionate</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="submitController" disabled onclick="updateJsonController()">Create</button>
        </div>
      </div>
    </div>
  </div>
<!-- Modal2 -->

<div class="modal fade" id="exampleModalScript" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabelScript" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabelScript">Script config</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="filenameControllerScript">File name</label>
                <input type="text" class="form-control" id="filenameControllerScript" onchange="checkControllerScriptValid()" placeholder="Enter filename">
            </div>
            <div class="form-group">
                <label for="txtBodyControllerScript">Json config</label>
                <textarea class="form-control resizable-textarea" id="txtBodyControllerScript" min-rows="3" onchange="checkControllerScriptValid()"></textarea>
            </div>
            
          <div class="form-outline">
            <input type="number" placeholder="repetitions" id="repetitions" class="form-control" value="1" />
            <label class="form-label" for="repetitions">repetitions</label>
          </div>
          <div class="form-outline">
            <button type="button" class="btn btn-primary" id="submitAndRun" disabled onclick="submitAndRun()">run</button>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="killScript()">Close</button>
          <button type="button" class="btn btn-primary" id="submitScript" disabled onclick="updateScript()">Create</button>
        </div>
      </div>
    </div>
  </div>
<!-- Modal2 -->
<div class="modal fade" id="modalClone" tabindex="-1" role="dialog" aria-labelledby="modalCloneTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCloneTitle">Clone</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="filenameAmiibo">File name</label>
                <input type="text" class="form-control" id="filenameAmiibo" onchange="checkfilenameAmiiboValid()" placeholder="Enter filename">
                <input type="hidden" id="filenameAmiiboOrigin" name="filenameAmiiboOrigin" value="">
            </div>
        </div>
        <div class="modal-footer">
            <div class='d-flex justify-content-between'>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="persistAmiiboClone" disabled onclick="submitAndClone()" data-dismiss="modal">Clone and save</button>
                <button type="button" class="btn btn-primary" id="amiiboFastClone" onclick="clone()" data-dismiss="modal">Clone without saving</button>
            </div>
        </div>
      </div>
    </div>
  </div><!-- checkfilenameAmiiboValid() #filenameAmiibo #filenameAmiiboOrigin #persistAmiiboClone clone() submitAndClone()-->
  
  <!-- Modal -->
  <div class="modal fade" id="modalShutdown" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Connection</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <p>Connect raspberry to switch, shut down raspberry or restart it</p>
          
          {% if updatable %}
            <a href="/update" onclick="showSpinner()" class="btn btn-warning">Update</a>
          {% else %}
            <span class="btn btn-warning disabled">Update</span>
          {% endif %}
          <button type="button" class="btn btn-warning" onclick="Connection(this)" data-dismiss="modal">Connect/Disconnect</button>
          <button type="button" class="btn btn-danger" onclick="ShutDown(this)" data-dismiss="modal">Shut down</button>
          <button type="button" class="btn btn-danger" onclick="Reboot(this)" data-dismiss="modal">Reboot</button>
          <!--uploadConfFile-->
            <div class="form-group">
                {% if unfixed_exists %}
                    <label for="unfixed" class="text-primary">Update unfixed-info.bin File</label>
                {% endif %}
                {% if not unfixed_exists %}
                    <label for="unfixed" class="text-warning">Load unfixed-info.bin File</label>
                {% endif %}
                <input type="file" name="unfixed" id="unfixed" onchange="uploadConfFile('unfixed')">
            </div>
            <div class="form-group">
                {% if secret_exists %}
                    <label for="locked" class="text-primary">Update locked-secret.bin File</label>
                {% endif %}
                {% if not secret_exists %}
                    <label for="locked" class="text-warning">Load locked-secret.bin File</label>
                {% endif %}
                <input type="file" name="locked" id="locked" onchange="uploadConfFile('locked')">
            </div>
            {% if unfixed_exists and secret_exists and not amiibo_generator_loaded %}
                <p class="text-danger">Unfixed or locked files do not match</p>
            {% endif %}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="modalController" tabindex="-1" role="dialog" aria-labelledby="modalControllerLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalControllerLabel">Controller map</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            Map To connect controller
            <select id="selectedController" class="form-select" aria-label="Get controller" onchange="selectController()">
            </select>
            <button type="button" class="btn btn-danger" id="deleteMapButton" disabled onclick="deleteControllerMap()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
              </svg>
              </button>
            <div class="form-group">
                <label for="filenameControllerScriptMap">File name</label>
                <input type="text" class="form-control" id="filenameControllerCtrMap" onchange="checkControllerMapValid()" placeholder="Enter filename">
                <div class="invalid-feedback"></div>
            </div>
            <div class="form-group">
                <label for="txtBodyControllerCtr">Json config</label>
                <textarea class="form-control resizable-textarea" id="txtBodyControllerCtr" min-rows="3" onchange="checkControllerMapValid()"></textarea>
                <div class="invalid-feedback"></div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="setMapButton" disabled onclick="updateControllerMap()">Save and Set</button>
        </div>
      </div>
    </div>
  </div>
<script src="/static/popper.min.js"></script>
<script src="/static/bootstrap.min.js"></script>
<script>
    // Get all textarea elements with the class "resizable-textarea"
    const textareas = document.querySelectorAll('.resizable-textarea');

    // Add the same input event listener to each textarea
    textareas.forEach(function (textarea) {
        textarea.addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
        textarea.addEventListener('change', function () {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    });
    // Call the function every minute (60,000 milliseconds)
</script>
</body>
</html>